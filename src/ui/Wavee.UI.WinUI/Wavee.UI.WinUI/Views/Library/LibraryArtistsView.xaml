<?xml version="1.0" encoding="utf-8" ?>
<UserControl
    x:Class="Wavee.UI.WinUI.Views.Library.LibraryArtistsView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:animatedVisualPlayer="using:Wavee.UI.WinUI.Behaviors.AnimatedVisualPlayer"
    xmlns:animatedVisuals="using:AnimatedVisuals"
    xmlns:artist="using:Wavee.UI.WinUI.Views.Artist"
    xmlns:artist1="using:Wavee.UI.ViewModels.Artist"
    xmlns:common="using:Wavee.UI.WinUI.Views.Common"
    xmlns:common1="using:Wavee.UI.WinUI.Behaviors.common"
    xmlns:converters="using:Wavee.UI.WinUI.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
    xmlns:library="using:Wavee.UI.ViewModels.Library"
    xmlns:listViewBase="using:Wavee.UI.WinUI.Behaviors.ListViewBase"
    xmlns:local="using:Wavee.UI.WinUI.Views.Library"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:toolkit="using:CommunityToolkit.WinUI.Controls"
    DataContext="{x:Bind ViewModel}"
    Loaded="LibraryArtistsView_OnLoaded"
    Unloaded="LibraryArtistsView_OnUnloaded"
    mc:Ignorable="d">
    <UserControl.Transitions>
        <TransitionCollection>
            <EntranceThemeTransition />
        </TransitionCollection>
    </UserControl.Transitions>
    <Grid
        Margin="12,0,12,12"
        ColumnSpacing="8"
        RowSpacing="8">
        <Grid.ColumnDefinitions>
            <ColumnDefinition
                Width="250"
                MinWidth="100"
                MaxWidth="600" />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>
        <ScrollView
            x:Name="Scroller"
            Grid.Column="0"
            MinHeight="600"
            Padding="4"
            Background="{ThemeResource SolidBackgroundFillColorSecondaryBrush}"
            BorderBrush="{ThemeResource ControlStrokeColorOnAccentDefaultBrush}"
            BorderThickness="1"
            CornerRadius="4">
            <Grid>
                <ProgressBar
                    VerticalAlignment="Top"
                    IsIndeterminate="{x:Bind ViewModel.IsBusy, Mode=OneWay}"
                    Visibility="{x:Bind ViewModel.IsBusy, Mode=OneWay, Converter={StaticResource TrueToVisibleConverter}}" />

                <ItemsView IsItemInvokedEnabled="True" ItemsSource="{x:Bind ViewModel.Items, Mode=OneWay}">
                    <interactivity:Interaction.Behaviors>
                        <listViewBase:ItemInvokedBehavior ItemInvokedCommand="{x:Bind ViewModel.OnItemInvoked}" ItemSelectedCommand="{x:Bind ViewModel.OnItemSelectedCommand}" />
                        <common1:PlaybackStateBehaviorItemsView />
                    </interactivity:Interaction.Behaviors>
                    <ItemsView.Layout>
                        <UniformGridLayout
                            ItemsJustification="Start"
                            ItemsStretch="Fill"
                            MaximumRowsOrColumns="4"
                            MinItemHeight="78"
                            MinItemWidth="160" />
                    </ItemsView.Layout>
                    <ItemsView.ItemTemplate>
                        <DataTemplate x:DataType="library:LibraryItemViewModel">
                            <ItemContainer CanUserInvoke="UserCanInvoke">
                                <common:WaveeTrackHost
                                    HorizontalAlignment="Stretch"
                                    HorizontalContentAlignment="Stretch"
                                    Background="Transparent"
                                    PlaybackState="{x:Bind PlaybackState, Mode=OneWay}">
                                    <interactivity:Interaction.Behaviors>
                                        <common1:ElementPointerBehaviors HasPointer="{x:Bind IsHovered, Mode=TwoWay}" />
                                    </interactivity:Interaction.Behaviors>
                                    <RelativePanel Padding="8">
                                        <PersonPicture
                                            x:Name="Avatar"
                                            Width="58"
                                            Height="58"
                                            x:Phase="2"
                                            ProfilePicture="{x:Bind Item, Mode=OneWay, Converter={StaticResource WaveeItemToImageConverter}, ConverterParameter='80'}"
                                            RelativePanel.AlignLeftWithPanel="True" />
                                        <TextBlock
                                            x:Name="TitleBlock"
                                            Margin="6,8,0,0"
                                            x:Phase="1"
                                            FontWeight="SemiBold"
                                            RelativePanel.AlignTopWith="Avatar"
                                            RelativePanel.RightOf="Avatar"
                                            Text="{x:Bind Item.Name, Mode=OneWay}" />
                                        <TextBlock
                                            x:Name="AddedAtBlock"
                                            Margin="6,0,0,0"
                                            x:Phase="1"
                                            FontSize="12"
                                            Foreground="{ThemeResource ApplicationSecondaryForegroundThemeBrush}"
                                            RelativePanel.Below="TitleBlock"
                                            RelativePanel.RightOf="Avatar"
                                            Text="{x:Bind AddedAt, Mode=OneWay, Converter={StaticResource DateTimeToRelativeConverter}}" />

                                        <Grid
                                            Width="32"
                                            Height="32"
                                            RelativePanel.AlignRightWithPanel="True"
                                            RelativePanel.AlignVerticalCenterWithPanel="True"
                                            Visibility="{x:Bind converters:FunctionBindings.IsPlayingOrHovered(PlaybackState, IsHovered), Mode=OneWay}">
                                            <Button
                                                Padding="8"
                                                Command="{x:Bind PlayCommand, Mode=OneWay}"
                                                CommandParameter="{x:Bind This, Mode=OneWay}"
                                                CornerRadius="4"
                                                Style="{ThemeResource AccentButtonStyle}"
                                                Visibility="{x:Bind converters:FunctionBindings.IsOnlyPausedOrHoveredThenVisible(PlaybackState, IsHovered), Mode=OneWay}">
                                                <FontIcon
                                                    FontFamily="{StaticResource MediaPlayerIcons}"
                                                    FontSize="13"
                                                    Glyph="{x:Bind converters:FunctionBindings.IsPlayingThenPlayOrElsePausedIcon(PlaybackState), Mode=OneWay}" />
                                            </Button>

                                            <AnimatedVisualPlayer
                                                Width="24"
                                                Height="24"
                                                AutoPlay="False"
                                                PlaybackRate="1.5"
                                                Visibility="{x:Bind converters:FunctionBindings.IsONLYPlayingOrNonHoveredThenVisible(PlaybackState, IsHovered), Mode=OneWay}">
                                                <AnimatedVisualPlayer.Source>
                                                    <animatedVisuals:Playing />
                                                </AnimatedVisualPlayer.Source>
                                                <interactivity:Interaction.Behaviors>
                                                    <animatedVisualPlayer:SetAndLoopSourceBehavior LetsPlay="{x:Bind converters:FunctionBindings.IsPlayingThenTrue(PlaybackState), Mode=OneWay}" />
                                                </interactivity:Interaction.Behaviors>
                                            </AnimatedVisualPlayer>
                                        </Grid>
                                    </RelativePanel>
                                </common:WaveeTrackHost>
                            </ItemContainer>
                        </DataTemplate>
                    </ItemsView.ItemTemplate>
                </ItemsView>
            </Grid>
        </ScrollView>

        <Grid
            Grid.Row="0"
            Grid.Column="1"
            MinHeight="600"
            Padding="4"
            HorizontalAlignment="Stretch"
            BorderBrush="{ThemeResource ControlStrokeColorOnAccentDefaultBrush}"
            BorderThickness="1"
            CornerRadius="4">
            <common:ErrorsView
                Margin="24"
                Errors="{x:Bind ViewModel.Errors, Mode=OneWay}"
                Visibility="{x:Bind ViewModel.HasErrors, Mode=OneWay, Converter={StaticResource TrueToVisibleConverter}}" />


            <ContentControl
                x:Name="Gr"
                HorizontalContentAlignment="Stretch"
                VerticalContentAlignment="Top">
                <ContentControl.ContentTransitions>
                    <TransitionCollection>
                        <EntranceThemeTransition />
                    </TransitionCollection>
                </ContentControl.ContentTransitions>
            </ContentControl>

        </Grid>

        <toolkit:GridSplitter
            Grid.Row="0"
            Grid.RowSpan="2"
            Grid.Column="1"
            Width="16"
            HorizontalAlignment="Left"
            VerticalAlignment="Stretch"
            Foreground="Transparent"
            ResizeBehavior="BasedOnAlignment"
            ResizeDirection="Auto">
            <toolkit:GridSplitter.RenderTransform>
                <TranslateTransform X="-12" />
            </toolkit:GridSplitter.RenderTransform>
        </toolkit:GridSplitter>
    </Grid>
</UserControl>
